# Install node js server
---
- name: "Install nodejs server"
  hosts: all
  user: ubuntu
  become: true

  tasks:
#  - name: download and install node 6 binary
#    shell: curl https://nodejs.org/download/release/v6.17.1/node-v6.17.1-linux-x64.tar.gz | tar --strip-components 1 -xzvf - -C /usr/local

  - name: install npm and app dependencies
    apt:
      name:
        - npm
        - python
        - nodejs
      state: latest
      update_cache: yes

  - name: upgrade npm, use nodejs 14 
    shell: npm install -g n && n 14 && npm install -g npm && hash -d npm
    become: true
    register: result
    failed_when: result.rc != 0 and result.rc != 2
